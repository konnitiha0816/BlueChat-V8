<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Blue Chat</title>

<style>
html,body{
  width:100%;height:100%;margin:0;
  font-family:system-ui;
  color:white;overflow:hidden;
}
body{background-size:cover;background-position:center;}
body.day{background-image:url("https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1920&q=80");}
body.night{background-image:url("https://images.unsplash.com/photo-1444703686981-a3abbc4d4fe3?auto=format&fit=crop&w=1920&q=80");}

.center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
button{font-size:26px;padding:14px 50px;border-radius:10px;border:none;cursor:pointer}
input{font-size:24px;padding:10px;width:280px;text-align:center;border-radius:8px;border:none}

#blur{position:fixed;inset:0;backdrop-filter:blur(12px);background:rgba(0,0,0,.5)}
#version{position:fixed;top:10px;right:14px;font-size:12px;opacity:.7}

.hidden{display:none}
.choice{width:340px;margin:12px 0}

#call{background:#1e90ff}
#msg{background:gray}

#green{background:#00c853;font-size:32px;padding:20px 80px}
</style>
</head>

<body>
<div id="version">V8</div>
<div id="blur"></div>

<div id="tap" class="center">画面をタップしてください</div>

<div id="title" class="center hidden">
  <div style="font-size:96px;font-weight:800">Blue Chat</div>
  <button id="start">スタート</button>
</div>

<div id="captcha" class="center hidden">
  <div id="q" style="font-size:40px"></div>
  <input id="a" type="number">
  <div><button onclick="check()">確認</button></div>
  <div id="err" style="color:#ff8080"></div>
</div>

<div id="select" class="center hidden">
  <button id="call" class="choice">通話</button><br>
  <button id="msg" class="choice">メッセージ（メンテ中）</button>
</div>

<div id="callMenu" class="center hidden">
  <input id="callId" minlength="6" maxlength="20" placeholder="通話ID（6文字以上）"><br><br>
  <button onclick="join()">この通話に参加</button><br><br>
  <button onclick="create()">新しく通話を作る</button>
</div>

<div id="prepare" class="hidden" style="display:flex;height:100%">
  <div style="flex:2;background:#000;display:flex;align-items:center;justify-content:center">
    カメラ映像（準備中）
  </div>
  <div style="flex:1;padding:20px;background:#111">
    <h2>通話設定</h2>
    カメラ：ON<br><br>
    マイク：ON<br><br>
    画面共有：OFF<br><br>
    背景ぼかし：OFF<br><br><br>
    <button id="green">通話を開始</button>
  </div>
</div>

<audio id="bgm" loop><source src="title.mp3"></audio>

<script>
const h=new Date().getHours();
document.body.classList.add(h>=5&&h<17?"day":"night");

let x,y;
const show=id=>{
  document.querySelectorAll("body>div").forEach(d=>{
    d.id===id?d.classList.remove("hidden"):d.classList.add("hidden");
  });
};

blur.onclick=()=>{
  bgm.play();
  blur.style.display="none";
  show("title");
};

start.onclick=()=>{
  x=Math.floor(Math.random()*8)+2;
  y=Math.floor(Math.random()*8)+2;
  q.innerText=`${x} × ${y}`;
  show("captcha");
};

function check(){
  if(+a.value===x*y) show("select");
  else err.innerText="不正解です";
}

call.onclick=()=>show("callMenu");
msg.onclick=()=>alert("メンテナンス中です");

function validateId(){
  const len=callId.value.length;
  if(len<6||len>20){
    alert("通話IDは6〜20文字にしてください");
    return false;
  }
  return true;
}

function create(){
  if(!validateId()) return;
  show("prepare");
}

function join(){
  if(!validateId()) return;
  show("prepare");
}
</script>
</body>
</html>
